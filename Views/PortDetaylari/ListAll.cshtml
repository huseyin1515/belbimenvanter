@model IEnumerable<BelbimEnv.Models.PortDetay>
@using BelbimEnv.Models

@{
    ViewData["Title"] = "Tüm Portların Listesi";
}

<!-- EXCEL YÜKLEME MODAL PENCERESİ (Değişiklik yok) -->
<div class="modal fade" id="portExcelUploadModal" tabindex="-1" aria-labelledby="portExcelUploadModalLabel" aria-hidden="true">
    <!-- ... (Modal içeriği aynı kalacak) ... -->
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="fas fa-list-alt me-2"></i>@ViewData["Title"]</h3>
    <div>
        <div class="input-group d-inline-flex" style="width: 350px;">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" id="searchInput" class="form-control" placeholder="Ara...">
        </div>
        <button type="button" class="btn btn-success ms-2" data-bs-toggle="modal" data-bs-target="#portExcelUploadModal">
            <i class="fas fa-file-excel me-1"></i> Excel ile Yükle
        </button>
    </div>
</div>

<!-- Port Listesi Tablosu (GÜNCELLENDİ) -->
<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-sm">
                <thead class="table-light">
                    <tr>
                        <th>Ait Olduğu Sunucu</th>
                        <th>Lokasyon</th> <!-- YENİ SÜTUN -->
                        <th>Model</th> <!-- YENİ SÜTUN -->
                        <th>Service Tag</th> <!-- YENİ SÜTUN -->
                        <th>Port Tipi</th>
                        <th>MAC / WWPN</th>
                        <th>Açıklama</th>
                        <th>Link Durumu</th>
                        <th class="text-center" style="width: 120px;">İşlemler</th>
                    </tr>
                </thead>
                <tbody id="portTableBody">
                    @if (!Model.Any())
                    {
                        <tr><td colspan="9" class="text-center text-muted">Gösterilecek port kaydı bulunamadı.</td></tr>
                    }
                    @foreach (var port in Model)
                    {
                        <tr>
                            <td>
                                <a asp-controller="Servers" asp-action="Details" asp-route-id="@port.ServerId">
                                    @port.Server.HostDns
                                </a>
                            </td>
                            <td>@port.Server.Location</td> <!-- YENİ VERİ -->
                            <td>@port.Server.Model</td> <!-- YENİ VERİ -->
                            <td>@port.Server.ServiceTag</td> <!-- YENİ VERİ -->
                            <td><span class="badge bg-secondary">@port.PortTipi</span></td>
                            <td>
                                @if (port.PortTipi == PortTipiEnum.FC || port.PortTipi == PortTipiEnum.VirtualFC)
                                {
                                    <strong>Fiber MAC:</strong> 
                                    @port.FiberMAC
                                }
                                else if (port.PortTipi == PortTipiEnum.Bakir || port.PortTipi == PortTipiEnum.VirtualBakir)
                                {

                                    <strong>Bakır MAC:</strong> 
                                    @port.BakirMAC
                                }
                                else if (port.PortTipi == PortTipiEnum.SAN)
                                {

                                    <strong>WWPN:</strong> 
                                    @port.Wwpn
                                }
                            </td>
                            <td>@port.Aciklama</td>
                            <td>
                                @if (port.LinkStatus?.ToLower() == "up")
                                {
                                    <span class="badge bg-success">Up</span>
                                }
                                else if (port.LinkStatus?.ToLower() == "down")
                                {

                                    <span class="badge bg-danger">Down</span>
                                }
                                else
                                {

                                    <span class="badge bg-secondary">@port.LinkStatus</span>
                                }
                            </td>
                            <td class="text-center text-nowrap">
                                <a asp-controller="PortDetaylari" asp-action="Details" asp-route-id="@port.Id" class="btn btn-sm btn-outline-info" title="Port Detayları"><i class="fas fa-info-circle"></i></a>
                                <a asp-controller="PortDetaylari" asp-action="Edit" asp-route-id="@port.Id" class="btn btn-sm btn-outline-warning" title="Düzenle"><i class="fas fa-edit"></i></a>
                                <form asp-controller="PortDetaylari" asp-action="Delete" asp-route-id="@port.Id" method="post" class="d-inline" onsubmit="return confirm('Bu portu silmek istediğinizden emin misiniz?');"><button type="submit" class="btn btn-sm btn-outline-danger" title="Sil"><i class="fas fa-trash-alt"></i></button></form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <p id="noResultsMessage" class="text-center text-muted" style="display: none;">Arama kriterlerinize uygun sonuç bulunamadı.</p>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Arama Scripti (Değişiklik yok, tüm satırı aradığı için yeni sütunları otomatik kapsar) -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchInput = document.getElementById('searchInput');
            const tableBody = document.getElementById('portTableBody');
            const rows = tableBody.getElementsByTagName('tr');
            const noResultsMessage = document.getElementById('noResultsMessage');

            searchInput.addEventListener('keyup', function() {
                const filterText = searchInput.value.toLowerCase();
                let visibleRowCount = 0;
                for (let i = 0; i < rows.length; i++) {
                    const rowText = rows[i].textContent.toLowerCase();
                    if (rowText.includes(filterText)) {
                        rows[i].style.display = "";
                        visibleRowCount++;
                    } else {
                        rows[i].style.display = "none";
                    }
                }
                noResultsMessage.style.display = (visibleRowCount === 0) ? "block" : "none";
            });
        });
    </script>
}