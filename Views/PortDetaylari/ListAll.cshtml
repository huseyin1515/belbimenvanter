@model IEnumerable<BelbimEnv.Models.PortDetay>
@using BelbimEnv.Models

@{
    ViewData["Title"] = "Tüm Portların Listesi";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="fas fa-list-alt me-2"></i>@ViewData["Title"]</h3>
    <div class="w-50">
        <div class="input-group">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" id="searchInput" class="form-control" placeholder="Sunucu, Port Tipi, Açıklama, MAC, Switch Adı veya Portu ile ara...">
        </div>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>Ait Olduğu Sunucu</th>
                        <th>Port Tipi</th>
                        <th>MAC / WWPN</th>
                        <th>Açıklama (Otomatik)</th>
                        <th>Switch Adı</th>
                        <th>Switch Port</th>
                        <th class="text-center" style="width: 100px;">İşlemler</th>
                    </tr>
                </thead>
                <tbody id="portTableBody">
                    @if (!Model.Any())
                    {
                        <tr><td colspan="7" class="text-center text-muted">Gösterilecek port kaydı bulunamadı.</td></tr>
                    }
                    @foreach (var port in Model)
                    {
                        <tr>
                            <td><a asp-controller="Servers" asp-action="Details" asp-route-id="@port.ServerId">@port.Server.HostDns</a></td>
                            <td><span class="badge bg-secondary">@port.PortTipi</span></td>
                            <td>
                                @if (port.PortTipi == PortTipiEnum.FC || port.PortTipi == PortTipiEnum.VirtualFC)
                                {
                                    <strong>Fiber MAC:</strong> 
                                    @port.FiberMAC
                                }
                                else if (port.PortTipi == PortTipiEnum.Bakir)
                                {

                                    <strong>Bakır MAC:</strong> 
                                    @port.BakirMAC
                                }
                                else if (port.PortTipi == PortTipiEnum.SAN)
                                {

                                    <strong>WWPN:</strong> 
                                    @port.Wwpn
                                }
                            </td>
                            <td>@port.Aciklama</td>
                            <td>@port.SwName</td>
                            <td>@port.SwPort</td>
                            <td class="text-center">
                                <a asp-controller="PortDetaylari" asp-action="Edit" asp-route-id="@port.Id" class="btn btn-sm btn-outline-warning" title="Düzenle"><i class="fas fa-edit"></i></a>
                                <form asp-controller="PortDetaylari" asp-action="Delete" asp-route-id="@port.Id" method="post" class="d-inline" onsubmit="return confirm('Bu portu silmek istediğinizden emin misiniz?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="Sil"><i class="fas fa-trash-alt"></i></button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <p id="noResultsMessage" class="text-center text-muted" style="display: none;">Arama kriterlerinize uygun sonuç bulunamadı.</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchInput = document.getElementById('searchInput');
            const tableBody = document.getElementById('portTableBody');
            const rows = tableBody.getElementsByTagName('tr');
            const noResultsMessage = document.getElementById('noResultsMessage');

            searchInput.addEventListener('keyup', function() {
                const filterText = searchInput.value.toLowerCase();
                let visibleRowCount = 0;
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    // Bütün satırın metnini alarak arama yapıyoruz.
                    const rowText = row.textContent.toLowerCase();
                    if (rowText.includes(filterText)) {
                        row.style.display = "";
                        visibleRowCount++;
                    } else {
                        row.style.display = "none";
                    }
                }
                noResultsMessage.style.display = (visibleRowCount === 0) ? "block" : "none";
            });
        });
    </script>
}